/* LightboxSE is a small, simple lightbox alternative      */
/* Copyright Geoff Squires                           	   */
/* licensed under MIT  http://opensource.org/licenses/MIT  */

(function(a){jQuery.fn.lightboxSE=function(d){function u(m){function v(){r=!0;n=h.Image;switch(f[e].toLowerCase().slice(f[e].lastIndexOf("."))){case ".jpg":case ".jpeg":case ".png":case ".gif":case ".bmp":n=h.Image;break;case ".swf":n=h.Flash;break;case ".mov":n=h.QuickTime;break;default:n=h.Iframe}if(n==h.Image)if(0<k[e].length){var a=k[e],a=a.split(",");w(a[0],a[1])}else a=new Image,a.onload=function(){w(this.width,this.height)},a.src=f[e];else a=k[e],a=a.split(","),w(a[0],a[1]);s&&B()}function w(c,e){if(c>0.8*a(window).width()){var f=c/e;c=Math.round(0.8*a(window).width());e=Math.round(c/f)}e>0.8*a(window).height()&&(f=c/e,e=Math.round(0.8*a(window).height()),c=Math.round(e*f));var f=Math.round(a("#lightbox_background",g).width()/2-c/2),h=Math.round(a("#lightbox_background",g).height()/2-e/2);d.animateLightbox?b.animate({width:c,height:e,left:f,top:h},200,function(){C();D()}):b.animate({width:c,height:e,left:f,top:h},1,function(){C();D()})}function C(){var c=b.position(),f=c.left+b.width(),c=c.top;a("#lightboxCloseButton").css("left",f);a("#lightboxCloseButton").css("top",c);a("#lightboxCloseButton").css("visibility","visible");(d.showCaptionBar&&l[e].length||d.showCaptionBarAlways)&&a("#lightboxCaptionBar").css("visibility","visible");d.showPrevNext&&p&&(f=b.width(),c=b.height(),a("#lightboxPrevButton").css("left",f),a("#lightboxPrevButton").css("top",c),a("#lightboxPrevButton").css("visibility","visible"),f=b.width(),c=b.height(),a("#lightboxNextButton",b).css("left",f),a("#lightboxNextButton",b).css("top",c),a("#lightboxNextButton",b).css("visibility","visible"));d.showPlayPause&&p&&(f=b.width(),c=b.height(),a("#lightboxPlayButton",b).css("left",f),a("#lightboxPlayButton",b).css("top",c),a("#lightboxPauseButton").css("left",f),a("#lightboxPauseButton").css("top",c),s?a("#lightboxPauseButton").css("visibility","visible"):a("#lightboxPlayButton",b).css("visibility","visible"))}function x(){a("#lightboxCloseButton",g).css("visibility","hidden");a("#lightboxCaptionBar",b).css("visibility","hidden");a("#lightboxPrevButton",b).css("visibility","hidden");a("#lightboxNextButton",b).css("visibility","hidden");a("#lightboxPlayButton",b).css("visibility","hidden");a("#lightboxPauseButton",b).css("visibility","hidden")}function D(){l[e].length&&b.append('<div id="lightboxCaptionText" class="lightboxCaptionText">'+l[e]+"</div>");switch(n){case h.Image:a("#lightboxContent",b).append('<img id="lightboxInnerContent" src="'+f[e]+'" style="width:100%; height:100%; filter:alpha(opacity=0); opacity:0;-moz-opacity:0;"/>');var c=a("#lightboxContent",b);a("#lightboxInnerContent",c).animate({opacity:1,"-moz-opacity":1,"filter:alpha:opacity":100},300);d.overlayer&&a("#lightboxContent",b).append('<div id="lightboxOverlayer" class="lightboxOverlayer"></div>');break;case h.Iframe:a("#lightboxContent",b).append('<iframe id="lightboxInnerContent" src="'+f[e]+'" class="lightboxIFrameContent"/>');a("#lightboxPauseButton",b).css("visibility","hidden");a("#lightboxPlayButton",b).css("visibility","visible");q();break;case h.Flash:DetectFlashVer(8,0,0)?(c='<div id="lightboxInnerContent"><object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://fpdownload.macromedia.com/get/flashplayer/current/swflash.cab" id="lightbox_flashobj" ',c+='width="'+b.width()+'px" ',c+='height="'+b.height()+'px">',c+='<param name="movie" value="'+f[e]+'"/>',c+='<param name="quality" value="high"/>',c+='<param name="wmode" value="transparent"/>',c+='<embed src="'+f[e]+'" ',c+='quality="high" ',c+='type="application/x-shockwave-flash" ',c+='pluginspage="http://www.macromedia.com/go/getflashplayer" ',c+='width="'+b.width()+'px" ',c+='height="'+b.height()+'px"></embed>',c+="</object></div>",a("#lightboxContent",b).append(c)):a("#lightboxContent",b).append('<div id="lightboxInnerContent"/>An old version of the Flash plugin was detected. <strong><a href="http://www.macromedia.com/go/getflash/">Please upgrade your Flash plugin.</a></strong></div>'),StopPlayTimer()}r=!1}function y(){r||(q(),e++,e>=f.length&&(e=0),x(),a("#lightboxCaptionText",b).remove(),a("#lightboxInnerContent",b).remove(),d.overlayer&&a("#lightboxOverlayer",b).remove(),v())}function E(){r||(q(),e--,0>e&&(e=f.length-1),x(),a("#lightboxCaptionText",b).remove(),a("#lightboxInnerContent",b).remove(),d.overlayer&&a("#lightboxOverlayer",b).remove(),v())}function B(){!t&&0<z&&(t=!0,F=setInterval(u,z))}function q(){t&&(t=!1,clearInterval(F))}function u(){y()}function A(){q();x();d.keyboard&&a(document).unbind("keyup");a("#lightboxCloseButton",g).unbind("click");a("#lightboxPrevButton",b).unbind("click");a("#lightboxNextButton",b).unbind("click");a("#lightboxPlayButton",b).unbind("click");a("#lightboxPauseButton",b).unbind("click");a("#lightbox_background",g).unbind("click");d.animateLightbox?b.animate({width:0,height:0,left:"50%",top:"50%",opacity:0},200,function(){a("#lightbox_background",g).animate({opacity:0,"-moz-opacity":0,"filter:alpha:opacity":0},200,function(){g.remove()})}):g.remove()}var f=[],l=[],k=[],e=0,p=!1,s=d.autoPlay,z=d.slideshowTime,n=0,F=0,t=!1,G=a(m).attr("data-slideshow");f.length=0;l.length=0;k.length=0;if(G){var p=!0,H=0;a("a").each(function(){a(this).attr("data-lightbox")&&a(this).attr("data-slideshow")&&a(this).attr("data-slideshow")==G&&(f.push(a(this).attr("href")),a(this).attr("data-caption")?l.push(a(this).attr("data-caption")):l.push(""),a(this).attr("data-size")?k.push(a(this).attr("data-size")):k.push(""),a(this).attr("href")==a(m).attr("href")&&(e=H),H++)})}else f.push(a(m).attr("href")),a(m).attr("data-caption")?l.push(a(m).attr("data-caption")):l.push(""),a(m).attr("data-size")?k.push(a(m).attr("data-size")):k.push(""),z=0;a("body").append('<div id="lightboxSE" style="position:absolute; left:0; width:100%; height:100%; top:'+pageYOffset+'px;"></div>');var g=a("#lightboxSE","body");g.append('<div id="lightbox_background" class="lightboxBackground"></div>');d.animateLightbox?a("#lightbox_background",g).animate({opacity:d.backgroundOpacity,"-moz-opacity":d.backgroundOpacity,"filter:alpha:opacity":100*d.backgroundOpacity},300):a("#lightbox_background",g).css({opacity:d.backgroundOpacity,"-moz-opacity":d.backgroundOpacity,"filter:alpha:opacity":100*d.backgroundOpacity});d.backgroundClickable&&a("#lightbox_background",g).click(function(){A()});g.append('<div id="lightbox" class="lightbox" style="position:absolute; left:50%; width:0px; top:50%; height:0px;"></div>');var b=a("#lightbox",g);d.showToolTip?g.append('<div id="lightboxCloseButton" class="lightboxCloseButton" title="'+d.closeToolTip+'" style="visibility:hidden;"></div>'):g.append('<div id="lightboxCloseButton" class="lightboxCloseButton" style="visibility:hidden;"></div>');a("#lightboxCloseButton",g).click(function(){A()});b.append('<div id="lightboxCaptionBar" class="lightboxCaptionBar" style="visibility:hidden;"></div>');d.showPrevNext&&p&&(d.showToolTip?b.append('<div id="lightboxPrevButton" class="lightboxPrevButton" title="'+d.prevToolTip+'" style="visibility:hidden;"></div>'):b.append('<div id="lightboxPrevButton" class="lightboxPrevButton" style="visibility:hidden;"></div>'),a("#lightboxPrevButton",b).click(function(){E()}),d.showToolTip?b.append('<div id="lightboxNextButton" class="lightboxNextButton" title="'+d.nextToolTip+'" style="visibility:hidden;"></div>'):b.append('<div id="lightboxNextButton" class="lightboxNextButton" style="visibility:hidden;"></div>'),a("#lightboxNextButton",b).click(function(){y()}));d.showPlayPause&&p&&(d.showToolTip?b.append('<div id="lightboxPlayButton" class="lightboxPlayButton" title="'+d.playToolTip+'" style="visibility:hidden;"></div>'):b.append('<div id="lightboxPlayButton" class="lightboxPlayButton" style="visibility:hidden;"></div>'),a("#lightboxPlayButton",b).click(function(){s=!0;B();a("#lightboxPlayButton",b).css("visibility","hidden");a("#lightboxPauseButton",b).css("visibility","visible")}),d.showToolTip?b.append('<div id="lightboxPauseButton" class="lightboxPauseButton" title="'+d.pauseToolTip+'" style="visibility:hidden;"></div>'):b.append('<div id="lightboxPauseButton" class="lightboxPauseButton" style="visibility:hidden;"></div>'),a("#lightboxPauseButton",b).click(function(){s=!1;q();a("#lightboxPlayButton",b).css("visibility","visible");a("#lightboxPauseButton",b).css("visibility","hidden")}));d.keyboard&&a(document).bind("keyup",function(a){keycode=null==a?event.keyCode:a.which;27==keycode&&A();if(0<f.length)switch(keycode){case 190:case 39:y();break;case 188:case 37:E()}});b.append('<div id="lightboxContent" class="lightboxContent"></div>');v();var r=!1}this.click(function(){u(this);return!1});d=jQuery.extend({animateLightbox:!0,autoPlay:!0,backgroundClickable:!0,backgroundOpacity:"0.6",keyboard:!0,overlayer:!0,showCaptionBar:!0,showCaptionBarAlways:!1,showPlayPause:!0,showPrevNext:!0,slideshowTime:4E3,showToolTip:!0,closeToolTip:"Close (Esc)",nextToolTip:"Next (>)",pauseToolTip:"Pause",playToolTip:"Play",prevToolTip:"Previous (<)"},d);var h={Image:0,Iframe:1,Flash:2,QuickTime:3}}})(jQuery);
